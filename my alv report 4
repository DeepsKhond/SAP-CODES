

REPORT  ZALV_REPORTD4_HIERARCHY.

TYPES : BEGIN OF lty_vbak,
       VBELN TYPE VBELN_VA,
       ERDAT TYPE ERDAT,
       ERZET TYPE ERZET,
       ERNAM TYPE ERNAM,
       VBTYP TYPE VBTYP,
  END OF lty_vbak.

  DATA : lt_vbak TYPE TABLE OF lty_vbak.
  DATA : ls_vbak TYPE lty_vbak.

TYPES : BEGIN OF lty_vbap,
       vbeln TYPE vbeln_va,
       posnr TYPE posnr_va,
       matnr TYPE matnr,

  END OF lty_vbap.

  DATA : lt_vbap TYPE TABLE OF lty_vbap.
  DATA : ls_vbap TYPE lty_vbap.
  DATA : lt_fieldcat TYPE SLIS_T_FIELDCAT_ALV.
  DATA : ls_fieldcat TYPE SLIS_FIELDCAT_ALV.
  DATA : ls_keyinfo TYPE SLIS_KEYINFO_ALV.

DATA : lv_vbeln TYPE vbeln_va.

SELECT-OPTIONS : s_vbeln FOR lv_vbeln.


SELECT vbeln erdat erzet ernam vbtyp
  FROM vbak
  INTO TABLE lt_vbak
  WHERE vbeln IN s_vbeln.


  IF lt_vbak IS NOT INITIAL.
    SELECT vbeln posnr matnr
      from vbap
      into table lt_vbap
      for all entries IN lt_vbak
      WHERE vbeln = lt_vbak-vbeln.

    ENDIF.


ls_fieldcat-col_pos = '1'.
ls_fieldcat-fieldname = 'VBELN'.
ls_fieldcat-tabname = 'LT_VBAK'.
ls_fieldcat-seltext_S = 'Sales document Number'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '2'.
ls_fieldcat-fieldname = 'V'.
ls_fieldcat-tabname = 'LT_VBAK'.
ls_fieldcat-seltext_S = 'CREATION DATE'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '3'.
ls_fieldcat-fieldname = 'ERZET'.
ls_fieldcat-tabname = 'LT_VBAK'.
ls_fieldcat-seltext_S = 'TIME'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '4'.
ls_fieldcat-fieldname = 'ERNAM'.
ls_fieldcat-tabname = 'LT_VBAK'.
ls_fieldcat-seltext_S = 'USER'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '5'.
ls_fieldcat-fieldname = 'VBTYP'.
ls_fieldcat-tabname = 'LT_VBAK'.
ls_fieldcat-seltext_S = 'DOC CATEGORY'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '1'.
ls_fieldcat-fieldname = 'VBELN'.
ls_fieldcat-tabname = 'LT_VBAP'.
ls_fieldcat-seltext_S = 'DOC CATEGORY'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '2'.
ls_fieldcat-fieldname = 'POSNR'.
ls_fieldcat-tabname = 'LT_VBAP'.
ls_fieldcat-seltext_l = 'ITEM NO'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.

ls_fieldcat-col_pos = '3'.
ls_fieldcat-fieldname = 'MATNR'.
ls_fieldcat-tabname = 'LT_VBAP'.
ls_fieldcat-seltext_S = 'MATERIAL NUMBER'.
APPEND ls_fieldcat to lt_fieldcat.
CLEAR : ls_fieldcat.


ls_keyinfo-header01 = 'VBELN'.
ls_keyinfo-item01 = 'VBELN'.

CALL FUNCTION 'REUSE_ALV_HIERSEQ_LIST_DISPLAY'
  EXPORTING
*   I_INTERFACE_CHECK              = ' '
*   I_CALLBACK_PROGRAM             =
*   I_CALLBACK_PF_STATUS_SET       = ' '
*   I_CALLBACK_USER_COMMAND        = ' '
*   IS_LAYOUT                      =
   IT_FIELDCAT                    = lt_fieldcat
*   IT_EXCLUDING                   =
*   IT_SPECIAL_GROUPS              =
*   IT_SORT                        =
*   IT_FILTER                      =
*   IS_SEL_HIDE                    =
*   I_SCREEN_START_COLUMN          = 0
*   I_SCREEN_START_LINE            = 0
*   I_SCREEN_END_COLUMN            = 0
*   I_SCREEN_END_LINE              = 0
*   I_DEFAULT                      = 'X'
*   I_SAVE                         = ' '
*   IS_VARIANT                     =
*   IT_EVENTS                      =
*   IT_EVENT_EXIT                  =
    I_TABNAME_HEADER               = 'LT-VBAK'
    I_TABNAME_ITEM                 = 'LT-VBAP'
*   I_STRUCTURE_NAME_HEADER        =
*   I_STRUCTURE_NAME_ITEM          =
    IS_KEYINFO                     = ls_keyinfo
*   IS_PRINT                       =
*   IS_REPREP_ID                   =
*   I_BYPASSING_BUFFER             =
*   I_BUFFER_ACTIVE                =
*   IR_SALV_HIERSEQ_ADAPTER        =
*   IT_EXCEPT_QINFO                =
*   I_SUPPRESS_EMPTY_DATA          = ABAP_FALSE
* IMPORTING
*   E_EXIT_CAUSED_BY_CALLER        =
*   ES_EXIT_CAUSED_BY_USER         =
  TABLES
    T_OUTTAB_HEADER                = lt_vbak
    T_OUTTAB_ITEM                  = lt_vbap
* EXCEPTIONS
*   PROGRAM_ERROR                  = 1
*   OTHERS                         = 2
          .
IF SY-SUBRC <> 0.
* Implement suitable error handling here
ENDIF.
