*&---------------------------------------------------------------------*
*& Report ZPA_SCOE_ALV_REPORT2
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT ZPA_SCOE_ALV_REPORT2.




TABLES: EKKO,EKPO.

TYPES: BEGIN OF STR_EKKO,
        EBELN TYPE EKKO-EBELN,
        BUKRS TYPE EKKO-BUKRS,
        ERNAM TYPE EKKO-ERNAM,
        LIFNR TYPE EKKO-LIFNR,
       END OF STR_EKKO.

 TYPES: BEGIN OF STR_EKPO,
         EBELN TYPE EKPO-EBELN,
         EBELP TYPE EKPO-EBELP,
         MATNR TYPE EKPO-MATNR,
         MATKL TYPE EKPO-MATKL,
         MENGE TYPE EKPO-MENGE,
         NETPR TYPE EKPO-NETPR,
       END OF STR_EKPO.

 TYPES: BEGIN OF STR_FINAL,
        EBELN TYPE EKKO-EBELN,
        BUKRS TYPE EKKO-BUKRS,
        ERNAM TYPE EKKO-ERNAM,
        LIFNR TYPE EKKO-LIFNR,
        EBELP TYPE EKPO-EBELP,
         MATNR TYPE EKPO-MATNR,
         MATKL TYPE EKPO-MATKL,
         MENGE TYPE EKPO-MENGE,
        NETPR TYPE EKPO-NETPR,
        END OF STR_FINAL.

   DATA: IT_EKKO TYPE TABLE OF STR_EKKO,
         WA_EKKO TYPE STR_EKKO,
         IT_EKPO TYPE TABLE OF STR_EKPO,
         WA_EKPO TYPE STR_EKPO,
         IT_FINAL TYPE TABLE OF STR_FINAL,
         WA_FINAL TYPE STR_FINAL,
         IT_FCAT TYPE SLIS_T_FIELDCAT_ALV,
         WA_FCAT TYPE SLIS_FIELDCAT_ALV,

         IT_SORT TYPE SLIS_T_SORTINFO_ALV,
         WA_SORT TYPE SLIS_SORTINFO_ALV,

         WA_LAYOUT TYPE SLIS_LAYOUT_ALV.

  SELECT-OPTIONS: P_VENDOR FOR EKKO-LIFNR.

  START-OF-SELECTION.
      SELECT
        EBELN
        BUKRS
        ERNAM
        LIFNR
      FROM EKKO INTO TABLE IT_EKKO
      WHERE LIFNR IN P_VENDOR.

    IF SY-SUBRC = 0.
      SELECT
       EBELN
       EBELP
       MATNR
       MATKL
       MENGE
       NETPR
       FROM EKPO
        INTO TABLE IT_EKPO
        FOR ALL ENTRIES IN IT_EKKO
       WHERE EBELN = IT_EKKO-EBELN.
*
    ENDIF.

    LOOP AT IT_EKPO INTO WA_EKPO.

      WA_FINAL-EBELN = WA_EKPO-EBELN.
      WA_FINAL-EBELP = WA_EKPO-EBELP.
      WA_FINAL-MATNR = WA_EKPO-MATNR.
      WA_FINAL-MATKL = WA_EKPO-MATKL.
      WA_FINAL-MENGE = WA_EKPO-MENGE.
      WA_FINAL-NETPR = WA_EKPO-NETPR.

      READ TABLE IT_EKKO INTO WA_EKKO WITH KEY EBELN = WA_FINAL-EBELN.
       WA_FINAL-BUKRS = WA_EKKO-BUKRS.
       WA_FINAL-ERNAM = WA_EKKO-ERNAM.
       WA_FINAL-LIFNR = WA_EKKO-LIFNR.

          .
       APPEND WA_FINAL TO IT_FINAL.
       CLEAR: WA_FINAL, WA_EKKO,WA_EKPO.

    ENDLOOP.

    WA_FCAT-COL_POS = '1'.
    WA_FCAT-FIELDNAME = 'LIFNR'.
    WA_FCAT-SELTEXT_L = 'VENDOR'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    WA_FCAT-COL_POS = '2'.
    WA_FCAT-FIELDNAME = 'EBELN'.
    WA_FCAT-SELTEXT_L = 'PURCHASE_ORDER'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    WA_FCAT-COL_POS = '3'.
    WA_FCAT-FIELDNAME = 'BUKRS'.
    WA_FCAT-SELTEXT_L = 'COMP_CODE'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    WA_FCAT-COL_POS = '4'.
    WA_FCAT-FIELDNAME = 'EBELP'.
    WA_FCAT-SELTEXT_L = 'ITEM_N0'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    WA_FCAT-COL_POS = '5'.
    WA_FCAT-FIELDNAME = 'MATNR'.
    WA_FCAT-SELTEXT_L = 'MATERIAL'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    WA_FCAT-COL_POS = '6'.
    WA_FCAT-FIELDNAME = 'MENGE'.

    WA_FCAT-SELTEXT_L = 'QTY'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    WA_FCAT-COL_POS = '7'.
    WA_FCAT-FIELDNAME = 'NETPR'.
    WA_FCAT-DO_SUM = 'X'.
    WA_FCAT-SELTEXT_L = 'NETPRICE'.
    APPEND WA_FCAT TO IT_FCAT.
    CLEAR WA_FCAT.

    " SORT
     WA_SORT-FIELDNAME = 'LIFNR'.
     WA_SORT-DOWN = 'X'.
     WA_SORT-SUBTOT = 'X'.
     APPEND WA_SORT TO IT_SORT.
     CLEAR WA_SORT.

     " LAYOUT.
     WA_LAYOUT-ZEBRA = 'X'.
     WA_LAYOUT-COLWIDTH_OPTIMIZE = 'X'.
*     wa_layout-


   CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
*      I_CALLBACK_PROGRAM                = ' '
*      I_STRUCTURE_NAME                  =
*      I_BACKGROUND_ID                   = ' '
      I_GRID_TITLE                      = 'PURCHASE ORDER REPORT'
*      I_GRID_SETTINGS                   =
*      IS_LAYOUT                         = WA_LAYOUT
      IT_FIELDCAT                       = IT_FCAT
*      IT_EXCLUDING                      =
*      IT_SPECIAL_GROUPS                 =
       IT_SORT                           = IT_SORT
*    IMPORTING
*      E_EXIT_CAUSED_BY_CALLER           =
*      ES_EXIT_CAUSED_BY_USER            =
     TABLES
       T_OUTTAB                          = IT_FINAL.
*    EXCEPTIONS
*      PROGRAM_ERROR                     = 1
*      OTHERS                            = 2
             .
   IF SY-SUBRC <> 0.
* Implement suitable error handling here
   ENDIF.
