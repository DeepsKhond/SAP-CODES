

REPORT  ZSCOE_REPORT5.



 DATA V_MATNR TYPE MARA-MATNR.
SELECT-OPTIONS SO_MATNR FOR V_MATNR DEFAULT 'M-12' TO 'M-20' NO-EXTENSION.

TYPES: BEGIN OF TY_SALESHEADER,
      MATNR TYPE MARA-MATNR,
      ERNAM TYPE MARA-ERNAM,
      VPSTA TYPE MARA-VPSTA,
      MBRSH TYPE MARA-MBRSH,
  END OF TY_SALESHEADER.


  DATA : T_SALESHEADER TYPE TABLE OF TY_SALESHEADER,
        WA_SALESHEADER TYPE TY_SALESHEADER.


  TYPES: BEGIN OF TY_SALESITEMS,
      VBELN TYPE VBAP-VBELN,
      POSNR TYPE VBAP-POSNR,
      MATNR TYPE VBAP-MATNR,
      NETWR TYPE VBAP-NETWR,
  END OF TY_SALESITEMS.

  DATA: T_SALESITEMS TYPE TABLE OF TY_SALESITEMS,
        WA_SALESITEMS TYPE TY_SALESITEMS.


 START-OF-SELECTION.

  PERFORM GETASALESHEADERDATA.
  IF T_SALESHEADER IS NOT INITIAL.
    PERFORM GETSALESITEMSDATA.
  IF T_SALESITEMS IS NOT INITIAL.
    PERFORM DISPLAYSALESDATA.
    ENDIF.
    ENDIF.

  FORM GETASALESHEADERDATA.
    SELECT MATNR ERNAM VPSTA MBRSH
      FROM MARA
      INTO TABLE T_SALESHEADER
       WHERE MATNR IN SO_MATNR.
    ENDFORM.






FORM GETSALESITEMSDATA.
*    LOOP AT T_SALESHEADER INTO WA_SALESHEADER.
    SELECT  VBELN POSNR MATNR NETWR
        FROM VBAP
        INTO TABLE T_SALESITEMS
*       APPENDING TABLE T_SALESITEMS
     FOR ALL ENTRIES IN  T_SALESHEADER
      WHERE MATNR = T_SALESHEADER-MATNR.

    ENDFORM.


    FORM DISPLAYSALESDATA.
      SORT  T_SALESHEADER BY MATNR.
      SORT T_SALESITEMS BY MATNR POSNR.
      LOOP AT T_SALESHEADER INTO WA_SALESHEADER.
        FORMAT COLOR 5.
        WRITE : / WA_SALESHEADER-MATNR,
                  WA_SALESHEADER-ERNAM,
                  WA_SALESHEADER-VPSTA,
                  WA_SALESHEADER-MBRSH.
        LOOP AT T_SALESITEMS INTO WA_SALESITEMS WHERE MATNR = WA_SALESHEADER-MATNR.
        FORMAT COLOR 7.
        WRITE: /5 WA_SALESITEMS-VBELN,
                  WA_SALESITEMS-POSNR,
                  WA_SALESITEMS-MATNR,
                  WA_SALESITEMS-NETWR.
        ENDLOOP.
        ENDLOOP.
  ENDFORM.
